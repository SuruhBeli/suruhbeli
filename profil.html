<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#FB923C">
  <link rel="icon" href="ikon-512.png">
<title>Profil - SuruhBeli</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

<!-- Firebase (SAMA SEPERTI HALAMAN KAMU) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
:root{
  /* ===== LIGHT MODE (DEFAULT SEKARANG) ===== */
  --bg-main:#FFF7ED;
  --text-main:#7C2D12;
  --card-bg:#ffffff;
  --border-soft:#FED7AA;
  --text-secondary:#374151;
  --text-muted:#6B7280;
  --accent:#FB923C;
  --active-bg:#FFF1E6;
  --navbar-bg: #FFF7ED;
  --navbar-text: #6B7280;
  --navbar-active-bg: #FB923C;
  --navbar-active-text: #FB923C;
  --navbar-border-radius: 35px;
  --navbar-shadow: 0 8px 20px rgba(0,0,0,0.15);
  --navbar-glass-bg: rgba(255,255,255,0.55);
  --navbar-glass-border: 1px solid rgba(255,255,255,0.35);
  --navbar-glass-blur: blur(14px);
  --nav-circle-shadow: none;
}

/* ===== DARK MODE GLOBAL ===== */
body.dark-mode{
  --bg-main:#0F172A;
  --text-main:#F8FAFC;
  --card-bg:#1E293B;
  --border-soft:#334155;
  --text-secondary:#E2E8F0;
  --text-muted:#94A3B8;
  --accent:#FB923C;
  --active-bg:#1E293B;
  --navbar-bg: rgba(30,41,59,0.85);
  --navbar-text: #94A3B8;
  --navbar-active-bg: #FB923C;
  --navbar-active-text: #FB923C;
  --navbar-shadow: 0 10px 30px rgba(0,0,0,0.45);
  --navbar-glass-bg: rgba(15,23,42,0.65);
  --navbar-glass-border: 1px solid rgba(148,163,184,0.15);
  --navbar-glass-blur: blur(16px);
  --nav-circle-shadow:
    0 8px 22px rgba(0,0,0,0.35),
    inset 0 2px 6px rgba(255,255,255,0.08);
}
/* ===== PAGE ZOOM OUT ANIMATION (MULUS, TANPA BOUNCE) ===== */
.page-wrapper {
  animation: pageZoomOut 0.35s ease forwards;
  transform-origin: center;
}

@keyframes pageZoomOut{
  0%{
    opacity: 0;
    transform: scale(1.05); /* mulai sedikit lebih besar */
  }
  100%{
    opacity: 1;
    transform: scale(1);    /* normal */
  }
}
body{
  background:var(--bg-main);
  color:var(--text-main);
  min-height:100vh;
  transition:background 0.3s ease, color 0.3s ease;
  padding-bottom: 50px;
}
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Nunito',sans-serif;
  -webkit-tap-highlight-color: transparent;
  user-select:none;
  -webkit-user-select:none;
  outline:none;
}

/* ===== HERO HEADER DINAMIS ===== */
.hero-profile{
  width:100%;
  height:240px; /* ðŸ”¥ sudah dilebarkan ke bawah */
  background:#FB923C;
  position:relative;
  overflow:hidden;
}

.hero-profile img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* Overlay biar teks/card tetap kebaca */
.hero-overlay{
  position:absolute;
  inset:0;
  background:linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.25));
}

/* ===== FLOATING PROFILE CARD ===== */
.profile-card{
  position:relative;
  margin:-70px 16px 0 16px;
  background:var(--card-bg);
  border-radius:22px;
  padding:14px 16px; /* ðŸ”¥ dari 18px â†’ 14px (lebih padat) */
  display:flex;
  align-items:center;
  gap:12px; /* ðŸ”¥ dari 16px â†’ 12px */

  box-shadow:0 16px 40px rgba(0,0,0,0.15);
  border:1px solid var(--border-soft);
  z-index:5;
}

/* ===== AVATAR (INISIAL) ===== */
.profile-avatar{
  width:70px;
  height:70px;
  border-radius:50%;
  background:#FB923C;
  color:white;
  font-size:28px;
  font-weight:800;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;

  box-shadow:0 8px 20px rgba(251,146,60,0.45);
}

/* ===== INFO USER (JARAK BARIS DIRAPATKAN) ===== */
.profile-info{
  display:flex;
  flex-direction:column;
  gap:2px; /* ðŸ”¥ dari 6px â†’ 2px (ini yang paling ngaruh) */
  overflow:hidden;
  line-height:1.2; /* ðŸ”¥ bikin teks lebih rapat */
}

.profile-name{
  font-size:20px; /* sedikit diperkecil biar proporsional */
  font-weight:800;
  color:var(--text-main);
  margin-bottom:1px; /* kontrol jarak bawah nama */
}

.profile-email{
  font-size:13px; /* dari 14px */
  color:var(--text-secondary);
  word-break:break-all;
  margin:0;
}

.profile-phone{
  font-size:14px; /* dari 15px */
  font-weight:600;
  color:var(--text-secondary);
  margin-top:1px; /* jarak halus saja */
}

/* Spacing konten bawah (nanti untuk menu pengaturan) */
.content{
  padding:24px 16px;
}
/* ===== CARD PENGATURAN ===== */
.settings-card{
  background:var(--card-bg);
  border:1px solid var(--border-soft);
  border-radius:20px;
  padding:16px;
  box-shadow:0 10px 25px rgba(0,0,0,0.08);
}

.settings-title{
  font-weight:800;
  font-size:16px;
  margin-bottom:12px;
  color:var(--text-main);
}

.settings-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 16px; /* ðŸ”¥ lebih tinggi = lebih enak di tap */
  border-radius:16px;
  cursor:pointer;
  transition:0.2s ease;
  border-bottom:1px solid var(--border-soft);
}
/* Garis terakhir tidak ada*/
.settings-item:last-child{
  border-bottom:none;
}
.settings-item:active{
  background:var(--bg-main);
  transform:scale(0.98); /* efek ditekan kayak app */
  border-bottom:1px solid #F1F5F9;
}

.settings-left{
  display:flex;
  align-items:center;
  gap:12px;
  font-weight:800;
  font-size:15px;
  color:var(--text-secondary);
  letter-spacing:0.2px;
}
/*SVG DAN IKON PANAH*/
.settings-left svg{
  flex-shrink:0;
  width:22px;
  height:22px;
  color: var(--accent);
}
/* ===== POPUP OVERLAY ===== */
.popup-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
  padding:16px;
}

.popup-overlay.show{
  display:flex;
}

/* ===== POPUP EDIT ===== */
.popup-card{
  width:100%;
  max-width:380px;
  background:var(--card-bg);
  border-radius:22px;
  padding:22px 18px;
  text-align:center;
  animation:scaleIn 0.2s ease;
}

@keyframes scaleIn{
  from{transform:scale(0.9); opacity:0;}
  to{transform:scale(1); opacity:1;}
}

.popup-header{
  font-size:20px;
  font-weight:800;
  margin-bottom:16px;
  color:var(--text-main);
}

.edit-avatar-preview{
  width:90px;
  height:90px;
  border-radius:50%;
  background:#FB923C;
  color:white;
  font-size:34px;
  font-weight:800;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0 auto 12px auto;
  overflow:hidden;
}

.edit-avatar-preview img{
  width:100%;
  height:100%;
  object-fit:cover;
}

/* Button Upload */
.btn-upload{
  background:#FFF7ED;
  border:1px solid #FED7AA;
  padding:10px 16px;
  border-radius:12px;
  font-weight:600;
  margin-bottom:14px;
}

/* Input */
.input-field{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid var(--card-bg);
  margin-bottom:12px;
  font-size:14px;
  outline:none;
}

.input-field:focus{
  border-color:#FB923C;
}

/* Button Save */
.btn-save{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#FB923C;
  color:white;
  font-weight:800;
  font-size:16px;
}

/* ===== CONFIRM POPUP ===== */
.confirm-card{
  position:relative; /* ðŸ”¥ KUNCI supaya img bisa keluar */
  background:var(--card-bg);
  border-radius:20px;
  padding:22px 18px;
  display:flex;
  align-items:center;
  max-width:360px;
  overflow:visible; /* ðŸ”¥ biar gambar bisa keluar frame */
}

.confirm-text{
  flex:1;
  font-weight:700;
  padding-right:80px; /*kasih ruang buat alert.png*/
  color:var(--text-secondary);
}

.alert-img{
  position:absolute;
  right:-35px;        /* ðŸ”¥ keluar sedikit ke kanan */
  top:-10px;          /* ðŸ”¥ kejar batas atas */
  bottom:-10px;       /* ðŸ”¥ kejar batas bawah */
  height:calc(100% + 20px); /* ðŸ”¥ lebih tinggi dari card */
  width:auto;         /* jaga rasio */
  max-width:140px;    /* batas biar tidak terlalu besar */
  object-fit:contain;
  pointer-events:none; /* biar tombol tetap bisa diklik */
}

.confirm-actions{
  margin-top:12px;
  display:flex;
  gap:8px;
}

.btn-cancel{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:1px solid #E5E7EB;
  background:white;
  font-weight:700;
}

.btn-ok{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:none;
  background:#FB923C;
  color:white;
  font-weight:800;
}
#btnLogout .settings-left span{
  color:#DC2626;
}
/* ===== FOOTER APP VERSION ===== */
.app-footer{
  text-align: center;
  font-size: 12px;
  color: var(--text-secondary); /* abu halus */
  padding: 2px 16px 50px;
  opacity: 0.9;
  letter-spacing: 0.3px;
}

/* Dark mode auto ikut */
body.dark .app-footer{
  color: #6B7280;
}
/* NAVBAR */
.navbar-bottom {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  max-width: 450px;
  height: 70px;

  background: var(--navbar-bg);
  border-radius: var(--navbar-border-radius);
  box-shadow: var(--navbar-shadow);

  display: flex;
  justify-content: space-around;
  align-items: center;
  z-index: 100;
  transition: all 0.35s ease;
}
/* ===============================
   MODE GEMPA / TRUE GLASSMORPHISM
   =============================== */
.navbar-bottom.gempa-mode{
  background: var(--navbar-glass-bg);
  backdrop-filter: blur(18px) saturate(140%);
  -webkit-backdrop-filter: blur(18px) saturate(140%);
  border: var(--navbar-glass-border);

  /* Shadow glass (lebih premium, tidak berat) */
  box-shadow:
    0 10px 30px rgba(0,0,0,0.25),
    inset 0 1px 0 rgba(255,255,255,0.15);
}

/* Highlight tipis biar efek glass lebih hidup */
.navbar-bottom.gempa-mode::before{
  content: "";
  position: absolute;
  top: 0;
  left: 12%;
  width: 76%;
  height: 1px;
  background: linear-gradient(
    to right,
    transparent,
    rgba(255,255,255,0.35),
    transparent
  );
  pointer-events: none;
}

/* ===============================
   NAV ITEM
   =============================== */
.nav-item {
  position: relative;
  flex: 1;
  text-align: center;
  cursor: pointer;
  color: var(--navbar-text);
  z-index: 2; /* di atas circle */
  transition: transform 0.2s ease;
}

/* Tap effect (mobile friendly hover) */
.nav-item:active{
  transform: scale(0.95);
}

/* ===============================
   ICON SVG
   =============================== */
.nav-item svg {
  width: 28px;
  height: 28px;
  fill: none;
  stroke: var(--navbar-text);
  stroke-width: 1.3;
  transition: 
    transform 0.4s cubic-bezier(.68,-0.55,.27,1.55),
    stroke 0.3s ease;
}

.nav-item.active svg {
  stroke: var(--navbar-active-text);
  transform: translateY(-15px) scale(1.25);
}

/* ===============================
   TEXT LABEL (FIX BUG WARNA)
   =============================== */
.nav-item span {
  display: block;
  margin-top: 1px;
  font-size: 15px;
  font-weight: 700;
  transition: transform 0.3s ease, color 0.3s ease;

  /* ðŸ”¥ FIX: default harus text biasa, bukan aktif */
  color: var(--navbar-text);
}

.nav-item.active span {
  transform: translateY(-5px);
  color: var(--navbar-active-text);
}

/* ===============================
   ACTIVE BACKGROUND CIRCLE (SMOOTH)
   =============================== */
.nav-active-circle {
  position: absolute;
  top: -22px;
  width: 62px;
  height: 62px;

  background: var(--border-soft);
  border-radius: 50%;

  /* pakai variable biar dinamis */
  box-shadow: var(--nav-circle-shadow);

  transition:
    left 0.45s cubic-bezier(.68,-0.55,.27,1.55),
    transform 0.3s ease;

  z-index: 1;
  pointer-events: none;
}

</style>
</head>
<body>
  <div class="page-wrapper">
<!-- ===== HEADER (AMBIL DARI FIRESTORE) ===== -->
<div class="hero-profile">
  <img id="heroImg" src="default.png" alt="Header Profil">
  <div class="hero-overlay"></div>
</div>

<!-- ===== CARD PROFIL TIMBUL ===== -->
<div class="profile-card">

  <!-- FOTO PROFIL (INISIAL) -->
  <div class="profile-avatar" id="profileAvatar">
    U
  </div>

  <!-- DATA USER -->
  <div class="profile-info">
    <div class="profile-name" id="profileName">Memuat profil...</div>
    <div class="profile-email" id="profileEmail">-</div>
    <div class="profile-phone" id="profilePhone">-</div>
  </div>

</div>

<div class="content">

  <!-- ===== CARD PENGATURAN ===== -->
  <div class="settings-card">
    <div class="settings-title">Pengaturan</div>
    <!-- Ubah profil -->
    <div class="settings-item" id="btnEditProfile">
      <div class="settings-left">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
          <path d="M21.731 2.269a2.625 2.625 0 0 0-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 0 0 0-3.712ZM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 0 0-1.32 2.214l-.8 2.685a.75.75 0 0 0 .933.933l2.685-.8a5.25 5.25 0 0 0 2.214-1.32l8.4-8.4Z" />
          <path d="M5.25 5.25a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3V13.5a.75.75 0 0 0-1.5 0v5.25a1.5 1.5 0 0 1-1.5 1.5H5.25a1.5 1.5 0 0 1-1.5-1.5V8.25a1.5 1.5 0 0 1 1.5-1.5h5.25a.75.75 0 0 0 0-1.5H5.25Z" />
        </svg>

        <span class="settings-text">Ubah Profil</span>
      </div>
      <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24">
        <path d="M9 6l6 6-6 6" fill="none" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    
    <!-- Mode Gelap -->
    <div class="settings-item" id="btnDarkMode">
      <div class="settings-left">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
          <path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.894 6.166a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.061l1.591-1.59ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5H21a.75.75 0 0 1 .75.75ZM17.834 18.894a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 1 0-1.061 1.06l1.59 1.591ZM12 18a.75.75 0 0 1 .75.75V21a.75.75 0 0 1-1.5 0v-2.25A.75.75 0 0 1 12 18ZM7.758 17.303a.75.75 0 0 0-1.061-1.06l-1.591 1.59a.75.75 0 0 0 1.06 1.061l1.591-1.59ZM6 12a.75.75 0 0 1-.75.75H3a.75.75 0 0 1 0-1.5h2.25A.75.75 0 0 1 6 12ZM6.697 7.757a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 0 0-1.061 1.06l1.59 1.591Z" />
        </svg>
        <span class="settings-text" id="darkModeText">Mode Gelap</span>
      </div>
      <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24">
        <path d="M9 6l6 6-6 6" fill="none" stroke="#9CA3AF" stroke-width="2"/>
      </svg>
    </div>
  </div>
  
    <!-- ===== CARD LAINNYA ===== -->
  <div class="settings-card" style="margin-top:16px;">
    <div class="settings-title">Lainnya</div>
  
    <!-- Ketentuan Layanan -->
    <div class="settings-item" id="btnTerms">
      <div class="settings-left">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
            <path fill-rule="evenodd" d="M7.502 6h7.128A3.375 3.375 0 0 1 18 9.375v9.375a3 3 0 0 0 3-3V6.108c0-1.505-1.125-2.811-2.664-2.94a48.972 48.972 0 0 0-.673-.05A3 3 0 0 0 15 1.5h-1.5a3 3 0 0 0-2.663 1.618c-.225.015-.45.032-.673.05C8.662 3.295 7.554 4.542 7.502 6ZM13.5 3A1.5 1.5 0 0 0 12 4.5h4.5A1.5 1.5 0 0 0 15 3h-1.5Z" clip-rule="evenodd" />
            <path fill-rule="evenodd" d="M3 9.375C3 8.339 3.84 7.5 4.875 7.5h9.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V9.375Zm9.586 4.594a.75.75 0 0 0-1.172-.938l-2.476 3.096-.908-.907a.75.75 0 0 0-1.06 1.06l1.5 1.5a.75.75 0 0 0 1.116-.062l3-3.75Z" clip-rule="evenodd" />
        </svg>

        <span>Ketentuan Layanan</span>
      </div>
      <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24">
        <path d="M9 6l6 6-6 6" fill="none" stroke="#9CA3AF" stroke-width="2"/>
      </svg>
    </div>
  
    <!-- Kebijakan Privasi -->
    <div class="settings-item" id="btnPrivacy">
      <div class="settings-left">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
          <path fill-rule="evenodd" d="M12.516 2.17a.75.75 0 0 0-1.032 0 11.209 11.209 0 0 1-7.877 3.08.75.75 0 0 0-.722.515A12.74 12.74 0 0 0 2.25 9.75c0 5.942 4.064 10.933 9.563 12.348a.749.749 0 0 0 .374 0c5.499-1.415 9.563-6.406 9.563-12.348 0-1.39-.223-2.73-.635-3.985a.75.75 0 0 0-.722-.516l-.143.001c-2.996 0-5.717-1.17-7.734-3.08Zm3.094 8.016a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
        </svg>


        <span>Kebijakan Privasi</span>
      </div>
      <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24">
        <path d="M9 6l6 6-6 6" fill="none" stroke="#9CA3AF" stroke-width="2"/>
      </svg>
    </div>
  
    <!-- Ajak Teman Desa -->
    <div class="settings-item" id="btnInvite">
      <div class="settings-left">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
          <path fill-rule="evenodd" d="M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z" clip-rule="evenodd" />
        </svg>

        <span>Ajak Teman Desa</span>
      </div>
      <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24">
        <path d="M9 6l6 6-6 6" fill="none" stroke="#9CA3AF" stroke-width="2"/>
      </svg>
    </div>
  
    <!-- Feedback -->
    <div class="settings-item" id="btnFeedback">
      <div class="settings-left">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
        <path d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z" />
      </svg>

        <span>Feedback dan Laporan</span>
      </div>
      <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24">
        <path d="M9 6l6 6-6 6" fill="none" stroke="#9CA3AF" stroke-width="2"/>
      </svg>
    </div>
 
     <!-- Tentang Aplikasi -->
    <div class="settings-item" id="btnTentang">
      <div class="settings-left">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
          <path d="M11.25 5.337c0-.355-.186-.676-.401-.959a1.647 1.647 0 0 1-.349-1.003c0-1.036 1.007-1.875 2.25-1.875S15 2.34 15 3.375c0 .369-.128.713-.349 1.003-.215.283-.401.604-.401.959 0 .332.278.598.61.578 1.91-.114 3.79-.342 5.632-.676a.75.75 0 0 1 .878.645 49.17 49.17 0 0 1 .376 5.452.657.657 0 0 1-.66.664c-.354 0-.675-.186-.958-.401a1.647 1.647 0 0 0-1.003-.349c-1.035 0-1.875 1.007-1.875 2.25s.84 2.25 1.875 2.25c.369 0 .713-.128 1.003-.349.283-.215.604-.401.959-.401.31 0 .557.262.534.571a48.774 48.774 0 0 1-.595 4.845.75.75 0 0 1-.61.61c-1.82.317-3.673.533-5.555.642a.58.58 0 0 1-.611-.581c0-.355.186-.676.401-.959.221-.29.349-.634.349-1.003 0-1.035-1.007-1.875-2.25-1.875s-2.25.84-2.25 1.875c0 .369.128.713.349 1.003.215.283.401.604.401.959a.641.641 0 0 1-.658.643 49.118 49.118 0 0 1-4.708-.36.75.75 0 0 1-.645-.878c.293-1.614.504-3.257.629-4.924A.53.53 0 0 0 5.337 15c-.355 0-.676.186-.959.401-.29.221-.634.349-1.003.349-1.036 0-1.875-1.007-1.875-2.25s.84-2.25 1.875-2.25c.369 0 .713.128 1.003.349.283.215.604.401.959.401a.656.656 0 0 0 .659-.663 47.703 47.703 0 0 0-.31-4.82.75.75 0 0 1 .83-.832c1.343.155 2.703.254 4.077.294a.64.64 0 0 0 .657-.642Z" />
        </svg>

        <span>Tentang Aplikasi</span>
      </div>
      <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24">
        <path d="M9 6l6 6-6 6" fill="none" stroke="#9CA3AF" stroke-width="2"/>
      </svg>
    </div>
    
    <!-- Keluar -->
    <div class="settings-item" id="btnLogout">
      <div class="settings-left">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
          <path d="M9.97.97a.75.75 0 0 1 1.06 0l3 3a.75.75 0 0 1-1.06 1.06l-1.72-1.72v3.44h-1.5V3.31L8.03 5.03a.75.75 0 0 1-1.06-1.06l3-3ZM9.75 6.75v6a.75.75 0 0 0 1.5 0v-6h3a3 3 0 0 1 3 3v7.5a3 3 0 0 1-3 3h-7.5a3 3 0 0 1-3-3v-7.5a3 3 0 0 1 3-3h3Z" />
          <path d="M7.151 21.75a2.999 2.999 0 0 0 2.599 1.5h7.5a3 3 0 0 0 3-3v-7.5c0-1.11-.603-2.08-1.5-2.599v7.099a4.5 4.5 0 0 1-4.5 4.5H7.151Z" />
        </svg>

        <span>Keluar</span>
      </div>
      <svg class="arrow-icon" width="20" height="20" viewBox="0 0 24 24">
        <path d="M9 6l6 6-6 6" fill="none" stroke="#9CA3AF" stroke-width="2"/>
      </svg>
    </div>
  
  </div>

</div>

<!-- ===== POPUP EDIT PROFIL ===== -->
<div class="popup-overlay" id="editPopup">
  <div class="popup-card">

    <div class="popup-header">
      Edit Profil
    </div>

    <!-- Preview Foto -->
    <div class="edit-avatar-preview" id="editAvatarPreview">U</div>

    <!-- Input Foto -->
    <input type="file" id="inputPhoto" accept="image/*" hidden>
    <button class="btn-upload" id="btnUploadPhoto">Pilih Foto</button>

    <!-- Input Nama -->
    <input type="text" id="editNama" class="input-field" placeholder="Nama">

    <!-- Input No HP -->
    <input type="tel" id="editNoHP" class="input-field" placeholder="No HP">

    <button class="btn-save" id="btnSaveProfile">Simpan</button>
  </div>
</div>

<!-- ===== POPUP KONFIRMASI (CUSTOM ALERT) ===== -->
<div class="popup-overlay" id="confirmPopup">
  <div class="confirm-card">
    <div class="confirm-text">
      Apakah sudah yakin?
      <div class="confirm-actions">
        <button class="btn-cancel" id="btnCancelConfirm">Batal</button>
        <button class="btn-ok" id="btnOkConfirm">Oke</button>
      </div>
    </div>
    <img src="alert.png" class="alert-img" alt="alert">
  </div>
</div>

<!-- ===== POPUP SUKSES ===== -->
<div class="popup-overlay" id="successPopup">
  <div class="confirm-card">
    <div class="confirm-text">
      Profil berhasil diperbarui
      <div class="confirm-actions">
        <button class="btn-ok" id="btnCloseSuccess">Oke</button>
      </div>
    </div>
    <img src="alert.png" class="alert-img" alt="alert">
  </div>
</div>

<div class="app-footer">
  SuruhBeli versi 2.12.1
</div>
</div>
<div class="navbar-bottom">
  <div class="nav-active-circle" id="navCircle"></div>

  <div class="nav-item" data-index="0" data-href="index.html">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
      <path d="M11.47 3.841a.75.75 0 0 1 1.06 0l8.69 8.69a.75.75 0 1 0 1.06-1.061l-8.689-8.69a2.25 2.25 0 0 0-3.182 0l-8.69 8.69a.75.75 0 1 0 1.061 1.06l8.69-8.689Z" />
      <path d="m12 5.432 8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 0 1-.75-.75v-4.5a.75.75 0 0 0-.75-.75h-3a.75.75 0 0 0-.75.75V21a.75.75 0 0 1-.75.75H5.625a1.875 1.875 0 0 1-1.875-1.875v-6.198a2.29 2.29 0 0 0 .091-.086L12 5.432Z" />
    </svg>

    <span>Home</span>
  </div>
  <div class="nav-item" data-index="1" data-href="aktivitas.html">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
      <path fill-rule="evenodd" d="M7.502 6h7.128A3.375 3.375 0 0 1 18 9.375v9.375a3 3 0 0 0 3-3V6.108c0-1.505-1.125-2.811-2.664-2.94a48.972 48.972 0 0 0-.673-.05A3 3 0 0 0 15 1.5h-1.5a3 3 0 0 0-2.663 1.618c-.225.015-.45.032-.673.05C8.662 3.295 7.554 4.542 7.502 6ZM13.5 3A1.5 1.5 0 0 0 12 4.5h4.5A1.5 1.5 0 0 0 15 3h-1.5Z" clip-rule="evenodd" />
      <path fill-rule="evenodd" d="M3 9.375C3 8.339 3.84 7.5 4.875 7.5h9.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V9.375ZM6 12a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V12Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 15a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V15Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 18a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V18Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" />
    </svg>

    <span>Pesanan</span>
  </div>
  <div class="nav-item" data-index="2" data-href="chatlist.html">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
      <path fill-rule="evenodd" d="M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" clip-rule="evenodd" />
    </svg>

    <span>Profil</span>
  </div>
</div>
<script>
/* ===== FIREBASE CONFIG (SAMA DENGAN APP KAMU) ===== */
firebase.initializeApp({
  apiKey: "AIzaSyByQl0BXZoSMzrULUNA6l7UVFQjXmvsdJE",
  authDomain: "suruhbeli-e8ae8.firebaseapp.com",
  projectId: "suruhbeli-e8ae8"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* ===== LOAD HEADER DARI FIRESTORE =====
   Collection : stockfoto
   Document   : foto
   Field      : headerprofil
   Fallback   : default.png
*/
async function loadHeaderProfil(){
  const heroImg = document.getElementById("heroImg");

  // Antisipasi jika element belum ada
  if(!heroImg) return;

  try{
    const doc = await db.collection("stockfoto").doc("foto").get();

    if(doc.exists){
      const data = doc.data();
      const url = data.headerprofil;

      if(url && url.trim() !== ""){
        heroImg.src = url;

        // ðŸ”¥ Jika link rusak otomatis pakai default
        heroImg.onerror = function(){
          this.onerror = null;
          this.src = "default.png";
        };
      }else{
        heroImg.src = "default.png";
      }

    }else{
      heroImg.src = "default.png";
    }

  }catch(error){
    console.log("Gagal load header profil:", error);
    heroImg.src = "default.png";
  }
}

/* ===== SET DATA DEFAULT (ANTI KOSONG) ===== */
function setDefaultProfile(){
  const nameEl = document.getElementById("profileName");
  const emailEl = document.getElementById("profileEmail");
  const phoneEl = document.getElementById("profilePhone");
  const avatarEl = document.getElementById("profileAvatar");

  if(nameEl) nameEl.textContent = "Pengguna";
  if(emailEl) emailEl.textContent = "-";
  if(phoneEl) phoneEl.textContent = "-";
  if(avatarEl) avatarEl.textContent = "U";
}

/* ===== LOAD DATA PROFIL USER =====
   Collection : users
   Doc        : UID user login
   Field DB   : nama, noHP (PENTING: H besar)
*/
auth.onAuthStateChanged(async (user) => {

  // Load header selalu (baik login / tidak)
  loadHeaderProfil();

  const nameEl = document.getElementById("profileName");
  const emailEl = document.getElementById("profileEmail");
  const phoneEl = document.getElementById("profilePhone");
  const avatarEl = document.getElementById("profileAvatar");

  // Jika belum login
  if(!user){
    if(nameEl) nameEl.textContent = "Belum Login";
    if(emailEl) emailEl.textContent = "-";
    if(phoneEl) phoneEl.textContent = "-";
    if(avatarEl) avatarEl.textContent = "?";
    return;
  }

  try{
    const userDoc = await db.collection("users").doc(user.uid).get();

    if(userDoc.exists){
      const data = userDoc.data();

      /* ===== PENTING: SESUAIKAN DENGAN FIRESTORE KAMU =====
         Kamu bilang field = "noHP"
         Jadi harus EXACT: data.noHP (case-sensitive)
      */
      const nama =
        data.nama ||
        data.name ||
        "Pengguna";

      const nohp =
        data.noHP ||     // ðŸ”¥ FIELD UTAMA DATABASE KAMU
        data.nohp ||     // backup kalau typo kecil
        data.phone ||    // backup umum
        user.phoneNumber || // kalau pakai auth phone
        "-";

      const email =
        user.email ||
        data.email ||
        "-";

      // Tampilkan ke UI
      if(nameEl) nameEl.textContent = nama;
      if(emailEl) emailEl.textContent = email;
      if(phoneEl) phoneEl.textContent = nohp;

      // ðŸ”¥ Avatar inisial otomatis dari nama
      if(avatarEl){
        if(nama && nama.length > 0){
          avatarEl.textContent = nama.charAt(0).toUpperCase();
        }else{
          avatarEl.textContent = "U";
        }
      }

    }else{
      // Jika dokumen users/{uid} belum dibuat
      console.log("Dokumen user belum ada di Firestore");

      if(nameEl) nameEl.textContent = "Pengguna";
      if(emailEl) emailEl.textContent = user.email || "-";
      if(phoneEl) phoneEl.textContent = "-";
      if(avatarEl) avatarEl.textContent = "U";
    }

  }catch(error){
    console.log("Error load profil:", error);

    if(nameEl) nameEl.textContent = "Error memuat profil";
    if(emailEl) emailEl.textContent = "-";
    if(phoneEl) phoneEl.textContent = "-";
    if(avatarEl) avatarEl.textContent = "!";
  }
});
/* ===== LOCAL STORAGE PHOTO ===== */
function loadLocalAvatar(){
  const savedPhoto = localStorage.getItem("profilePhoto");
  const avatarEl = document.getElementById("profileAvatar");

  if(savedPhoto && avatarEl){
    avatarEl.innerHTML = `<img src="${savedPhoto}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
  }
}

/* ===== POPUP CONTROL ===== */
const editPopup = document.getElementById("editPopup");
const confirmPopup = document.getElementById("confirmPopup");
const successPopup = document.getElementById("successPopup");

document.getElementById("btnEditProfile").onclick = () => {
  const name = document.getElementById("profileName").textContent;
  const phone = document.getElementById("profilePhone").textContent;

  document.getElementById("editNama").value = name !== "Memuat profil..." ? name : "";
  document.getElementById("editNoHP").value = phone !== "-" ? phone : "";

  editPopup.classList.add("show");
};
    /* ===== DARK MODE BUTTON ===== */
  const darkModeText = document.getElementById("darkModeText");
  const btnDarkMode = document.getElementById("btnDarkMode");
  
  btnDarkMode.onclick = () => {
    confirmPopup.classList.add("show");
    pendingDarkToggle = true; // tandai ini aksi dark mode
  };
editPopup.onclick = (e)=>{
  if(e.target === editPopup){
    editPopup.classList.remove("show");
  }
};

/* ===== UPLOAD FOTO GALERI ===== */
const inputPhoto = document.getElementById("inputPhoto");
const editPreview = document.getElementById("editAvatarPreview");

document.getElementById("btnUploadPhoto").onclick = () => {
  inputPhoto.click();
};

inputPhoto.onchange = function(){
  const file = this.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(e){
    const base64 = e.target.result;

    // preview di popup
    editPreview.innerHTML = `<img src="${base64}">`;

    // simpan sementara
    localStorage.setItem("tempProfilePhoto", base64);
  };
  reader.readAsDataURL(file);
};

/* ===== SAVE PROFILE (MUNCUL KONFIRMASI) ===== */
let pendingSave = false;
let pendingDarkToggle = false; // ðŸ”¥ TAMBAHAN

document.getElementById("btnSaveProfile").onclick = () => {
  confirmPopup.classList.add("show");
  pendingSave = true;
};

document.getElementById("btnCancelConfirm").onclick = () => {
  confirmPopup.classList.remove("show");
  pendingSave = false;
};

/* ===== OK CONFIRM (FINAL: SAVE + DARK MODE TANPA TABRAKAN) ===== */
document.getElementById("btnOkConfirm").onclick = async () => {

  confirmPopup.classList.remove("show");

  /* ===== PRIORITAS 1: DARK MODE ===== */
  if(pendingDarkToggle){
    pendingDarkToggle = false;

    const isDark = document.body.classList.contains("dark-mode");

    if(isDark){
      document.body.classList.remove("dark-mode");
      localStorage.setItem("themeMode", "light");
      if(darkModeText) darkModeText.textContent = "Mode Gelap";
    }else{
      document.body.classList.add("dark-mode");
      localStorage.setItem("themeMode", "dark");
      if(darkModeText) darkModeText.textContent = "Mode Cerah";
    }

    return; // â›” STOP supaya tidak lanjut ke save profile
  }

  /* ===== PRIORITAS 2: SAVE PROFILE ===== */
  if(!pendingSave) return;
  pendingSave = false;

  const user = auth.currentUser;
  if(!user) return;

  const nama = document.getElementById("editNama").value.trim();
  const noHP = document.getElementById("editNoHP").value.trim();
  const tempPhoto = localStorage.getItem("tempProfilePhoto");

  try{
    await db.collection("users").doc(user.uid).update({
      nama: nama,
      noHP: noHP
    });

    if(tempPhoto){
      localStorage.setItem("profilePhoto", tempPhoto);
      localStorage.removeItem("tempProfilePhoto");

      const avatarEl = document.getElementById("profileAvatar");
      avatarEl.innerHTML = `<img src="${tempPhoto}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
    }

    document.getElementById("profileName").textContent = nama || "Pengguna";
    document.getElementById("profilePhone").textContent = noHP || "-";

    editPopup.classList.remove("show");
    successPopup.classList.add("show");

  }catch(err){
    console.log("Error update profil:", err);
  }
};

document.getElementById("btnCloseSuccess").onclick = () => {
  successPopup.classList.remove("show");
};

/* ===== LOAD THEME SAAT HALAMAN DIBUKA ===== */
function loadTheme(){
  const savedTheme = localStorage.getItem("themeMode");
  const darkModeText = document.getElementById("darkModeText");

  if(savedTheme === "dark"){
    document.body.classList.add("dark-mode");
    if(darkModeText) darkModeText.textContent = "Mode Cerah";
  }else{
    document.body.classList.remove("dark-mode");
    if(darkModeText) darkModeText.textContent = "Mode Gelap";
  }
}

window.addEventListener("load", () => {
  loadLocalAvatar();
  loadTheme(); // ðŸ”¥ TAMBAHAN
});
/* ===== NAVIGASI CARD LAINNYA ===== */

// Ketentuan Layanan
document.getElementById("btnTerms").onclick = () => {
  window.location.href = "ketentuan.html";
};

// Kebijakan Privasi
document.getElementById("btnPrivacy").onclick = () => {
  window.location.href = "kebijakan.html";
};

// Feedback & Laporan
document.getElementById("btnFeedback").onclick = () => {
  window.location.href = "feedback.html";
};

// Tentang Aplikasi
document.getElementById("btnTentang").onclick = () => {
  window.location.href = "tentang.html";
};

/* ===== AJAK TEMAN DESA (SHARE WHATSAPP) ===== */
document.getElementById("btnInvite").onclick = () => {
  const text = encodeURIComponent(
    "Yuk pakai aplikasi SuruhBeli! Bantu belanja desa jadi lebih mudah ðŸš€"
  );
  const waUrl = `https://wa.me/?text=${text}`;
  window.open(waUrl, "_blank");
};

/* ===== LOGOUT SYSTEM DENGAN POPUP KONFIRMASI ===== */
let pendingLogout = false;

document.getElementById("btnLogout").onclick = () => {
  confirmPopup.classList.add("show");
  pendingLogout = true;
};

const originalOkConfirm = document.getElementById("btnOkConfirm").onclick;

document.getElementById("btnOkConfirm").onclick = async () => {

  confirmPopup.classList.remove("show");

  /* ===== PRIORITAS LOGOUT (PALING ATAS) ===== */
  if(pendingLogout){
    pendingLogout = false;
    try{
      await auth.signOut();
      window.location.href = "register.html"; // ðŸ”¥ auto redirect setelah logout
    }catch(err){
      console.log("Error logout:", err);
    }
    return;
  }

  /* ===== JALANKAN LOGIKA LAMA (SAVE / DARK MODE) ===== */
  if(typeof originalOkConfirm === "function"){
    originalOkConfirm();
  }
};
/* === NAVBAR BAWAH === */
const navItems = document.querySelectorAll('.nav-item');
const navCircle = document.getElementById('navCircle');
document.querySelector('.navbar-bottom')
  .classList.toggle('gempa-mode');
  
function updateNavCircle(activeIndex) {
  const activeItem = navItems[activeIndex];
  if (!activeItem || !navCircle) return;

  // Hitung posisi center ikon relatif ke navbar
  const navbarRect = activeItem.parentElement.getBoundingClientRect();
  const icon = activeItem.querySelector('svg');
  const iconRect = icon.getBoundingClientRect();

  const centerX = iconRect.left + iconRect.width / 2 - navbarRect.left;

  navCircle.style.left = `${centerX - navCircle.offsetWidth / 2}px`;
  navCircle.style.transform = 'scale(1.15)';

  setTimeout(() => {
    navCircle.style.transform = 'scale(1)';
  }, 200);
}

// Inisialisasi tab aktif sesuai URL
let currentPage = window.location.pathname.split("/").pop() || 'index.html';
navItems.forEach((item, idx) => {
  if (item.dataset.href === currentPage) {
    item.classList.add('active');
    updateNavCircle(idx);
  }

  // Event klik
  item.addEventListener('click', (e) => {
    e.preventDefault();
    navItems.forEach(i => i.classList.remove('active'));
    item.classList.add('active');
    updateNavCircle(idx);

    setTimeout(() => {
      window.location.href = item.dataset.href;
    }, 250); // animasi bulatan selesai dulu
  });
});

// Update posisi saat resize / load
function updateActiveCircle() {
  const active = document.querySelector('.nav-item.active');
  if (active) {
    const idx = Array.from(navItems).indexOf(active);
    updateNavCircle(idx);
  }
}

window.addEventListener('resize', updateActiveCircle);
window.addEventListener('load', updateActiveCircle);
</script>

</body>
</html>